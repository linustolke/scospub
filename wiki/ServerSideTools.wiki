#summary An overview of the design of the Server Side Tools

= Server side tools =

== Prepare work units ==

Workunits are prepared by the scospub_work_generator program.

The program regularly:
  * Fetches a list of all projects and their sources.
  * Contact the source repositories to check for changes.
  * If any changes is seen in the repository, a new work unit is created and fed into the boinc structure.

== Handle result from Application ==

When the Application has uploaded a result, the result is validated.
Initially the simple_bitwise_validator is used from the boinc installation.

Then the information is assimilated.
The scospub_assimilator program takes care of this.
The result is then added into the scospub-specific tables in the database and can then be seen by the result presentation.

== CentralHost web server installation

The presentation of results and the configuration of projects uses
the boinc server web pages.
Including:
  * Base url
  * Web server configuration
  * php include files
  * Database (new tables for the scospub-level results)

=== Changes in configuration ===

The project configuration files are in html/scosconf.
/scosconf in the URL.

The scripts change the database directly.

=== Present the result ===

The presentation of results is in the html/scospres
both in the scospub project and in the installed
boinc server web pages.
It is /scospres in the URL.

The scripts fetch information directly from the database to present it.


== File/Project layout ==

From the SCOSPUB perspective it is the tool that is important and
not what OS project it is applied to.
This means that from the CheckHost and CheckHost administrators
perspective, he configures firstly what tools he would like to run
and then (if possible) what Project he wants to contribute to.


We work with alternative 1. It seems to fit better with the large-files
that would be the tools.
This also means that we can install application and tools directly from
Makefiles in the scosconf project.

There are also some ReasonsForHavingFileLayoutByProject.

In the projects/<WHATEVER> directory on the CentralHost
the following files are installed by make in the scospub project:

  apps/scospub/scospub_<VERSION>_<PLATFORM>/scospub_<VERSION>_<PLATFORM>
  (
  apps/wrapper/wrapper_<VERSION>_<PLATFORM>/wrapper_<VERSION>_<PLATFORM>
  apps/wrapper/wrapper_<VERSION>_<PLATFORM>/java=java_<VERSION>_<PLATFORM>
  apps/wrapper/wrapper_<VERSION>_<PLATFORM>/svn=svn_<VERSION>_<PLATFORM>
  )

All tools are run from scospub application.

Templates are simplified.

The following templates are installed:

  templates/scospub0_wu
  templates/scospub0_result
  templates/scospub1_wu
  templates/scospub1_result

where the number in the name reflects how many input files except for
job.xml that are provided and how many output files that are handled.

The job.xml is generated separate for every job
depending on the configurations of the project done 
by the [OpenSourceProjectAdministator]s
using the web interface.

In order not to affect the normal boinc handling of files,
we have a work directory where checked out files reside.
The layout is:
  /tmp/scospub/<OSPROJ>/repos/<configured paths>

All instances of applications from the same <OSPROJ> share the same
directory so
some locking or other protection mechanism
is needed to allow
multiple boinc clients.


== The database ==

=== Table scos_project: Project information ===
One line per project.
Active controls if the project should be built or not.

Project 1 is a dummy template project.

=== Table scos_tool: References to tools ===
Immutable fields:
  Connection to project,
  Toolname,
  Config.
Active=true signify the current configuration for a project.
Active=false signify historic information only available for reference.

Templates for allowed tools are entered with connection to project as 1.
Active then means available or not.

=== Table scos_source: References to source tree paths ===
All fields immutable except active.
Active=true signify the current configuration for a project.
Active=false signify historic information only available for reference.

=== Table scos_result ===
One row for each reported result.
Each result references a tool (active or passive).

Each result references one or more sources tree paths and contains their
version/date using a scos_result_source_reference table.