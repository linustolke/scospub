#!/bin/sh

# Tool to add tools according to project configuration.

PROJECT_DIR=@PROJECT_DIR@

echo select scos_project.name, scos_tools.name from scos_project, scos_tools where scos_project.id = project |
mysql -u osstest -D osstest --password=password |
while read proj tool
do
    mkdir -p ${PROJECT_DIR}/apps/${proj}
    for dir in ${PROJECT_DIR}/scospub/${tool}/${tool}_*;
    do
        wrapper=${dir}/wrapper_*
        verplat=`echo $wrapper | sed 's/^wrapper_//'`
        version=`echo $verplat | sed 's/_.*$//'`
        verplatdir="${PROJECT_DIR}/apps/${proj}/${tool}_${verplat}"
        mkdir -p "$verplatdir"
	cp $dir/$wrapper "$verplatdir"/${tool}_$verplat
	for file in $dir/*=*
        do
            cp $file "$verplatdir"
        done
    done
    cp ${PROJECT_DIR}/scospub/${tool}/${tool}_wu ${PROJECT_DIR}/templates
    cp ${PROJECT_DIR}/scospub/${tool}/${tool}_result ${PROJECT_DIR}/templates
done

